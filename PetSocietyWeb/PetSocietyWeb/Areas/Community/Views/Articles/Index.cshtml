@model IEnumerable<PetSocietyWeb.Models.Generated.Article>

@{
    ViewData["Title"] = "Index";
}

@section Styles
{
    <link rel="stylesheet" href="~/lib/datatables/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fixed-header-table/1.3.0/fixedHeaderTable.min.css" />
}

<h1>文章管理</h1>

<p>
    <a asp-action="Create">新增文章</a>
</p>
<table class="table table-striped table-hover table-bordered table-responsive">
    <thead class="table-light">
        <tr>
            <th>分類編號</th>
            <th>標籤編號</th>
            <th>會員編號</th>
            <th>文章標題</th>
            <th>文章內容</th>
            <th>留言次數</th>
            <th>發佈時間</th>
            <th>更新時間</th>
            <th>熱門度</th>
            <th>照片</th>
            <th></th>
            </tr>
    </thead>
    <tbody>
@* 
    <a asp-action="Edit" asp-route-id="@item.ArticleId">Edit</a> |
    <a asp-action="Details" asp-route-id="@item.ArticleId">Details</a> |
    <a asp-action="Delete" asp-route-id="@item.ArticleId">Delete</a>
</td> *@
@section Scripts
{
    <script src="~/lib/datatables/js/jquery.datatables.min.js"></script>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fixed-header-table/1.3.0/jquery.fixedheadertable.min.js"></script>
    <script>
        $(document).ready(function(){
            //alert("ready");
            $("table").dataTable({
                ajax:{
                    type:"POST",
                            url: "/Community/Articles/IndexJson",
                    dataSrc: function(data) {
                        return data;
                    }
                },
                columns:[
                    { data:"categoryId", width: "10%"},
                    { data:"tagId", width: "10%"},
                    { data:"memberId", width: "10%"},
                    { data:"title", width: "10%"},
                    { data:"content", width: "50%",
                                // 添加 render 函數來截斷內容
                render: function (data, type, row) {
                    const maxLength = 30; // 你可以自訂這個數字
                    // 檢查是否為顯示類型，並且數據存在且長度大於限制
                    if (type === 'display' && data && data.length > maxLength) {
                        // 截斷文本並加上省略號
                        return data.substr(0, maxLength) ;
                    }
                    // 否則返回原始數據
                    return data;
                }
                    },
                    { data:"commentCount", width: "10%"},
                    { data:"postDate", width: "10%",
                          "render": function (data, type, row) {
                          if (data && (type === 'display' || type === 'filter')) {
                            return moment(data).format('YYYY/MM/DD HH:mm');
                          }
                           return data;}
                    },
                    { data:"lastUpdate", width: "10%",
                                    "render": function (data, type, row) {
                                    if (data && (type === 'display' || type === 'filter')) {
                                        return moment(data).format('YYYY/MM/DD HH:mm');
                                    }
                                    return data;}
                    },
                    { data:"popular", width: "10%"},
                    { data:null,
                            "render": function (data, type, row) {
                            return `<img style="width:100px;height:78px" src="${row.picture}"/> `;
                            ;}
                    },
                    {
                           "data": null,
                           // 修改/詳細/刪除 按鈕
                           "render": function (data, type, row) {
                                   return  `<a href="/Community/Articles/Details/${data.articleId}"class="btn  mb-1">詳細</a>` +
                                           `<a href="/Community/Articles/Edit/${data.articleId}"class="btn  mb-1">編輯</a>` +
                                           `<a href="/Community/Articles/Delete/${data.articleId}"class="btn  mb-1">刪除</a>`;
                           },
                           "width": "10%"}
                ],
                fixedHeader:{
                    header:true
                },
                language:{
                    url: '//cdn.datatables.net/plug-ins/1.13.1/i18n/zh-HANT.json',
                }
                 });
            });
        </script> 
        }
    </tbody>
</table>