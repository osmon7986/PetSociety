<div class="card custom-card border-0 shadow-sm rounded-4 overflow-hidden h-100">
  <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
    <h4 class="fw-bold text-dark-brown mb-3">
      <i class="bi bi-heart-fill text-danger me-2"></i>我的收藏
    </h4>
    <ul class="nav nav-tabs card-header-tabs border-0">
      <li class="nav-item">
        <button class="nav-link rounded-top-3 px-3 px-md-4 fw-bold d-flex align-items-center"
          [class.active]="activeTab === 'product'" [class.text-dark-brown]="activeTab === 'product'"
          [class.text-muted-custom]="activeTab !== 'product'" (click)="onTabChange('product')">
          <i class="bi bi-shop-window me-2 fs-5"></i>
          商城
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link rounded-top-3 px-3 px-md-4 fw-bold d-flex align-items-center"
          [class.active]="activeTab === 'activity'" [class.text-dark-brown]="activeTab === 'activity'"
          [class.text-muted-custom]="activeTab !== 'activity'" (click)="onTabChange('activity')">
          <i class="bi bi-calendar2-heart me-2 fs-5"></i>
          活動
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link rounded-top-3 px-3 px-md-4 fw-bold d-flex align-items-center"
          [class.active]="activeTab === 'course'" [class.text-dark-brown]="activeTab === 'course'"
          [class.text-muted-custom]="activeTab !== 'course'" (click)="onTabChange('course')">
          <i class="bi bi-mortarboard me-2 fs-5"></i>
          課程
        </button>
      </li>
      <li class="nav-item">
        <button class="nav-link rounded-top-3 px-3 px-md-4 fw-bold d-flex align-items-center"
          [class.active]="activeTab === 'article'" [class.text-dark-brown]="activeTab === 'article'"
          [class.text-muted-custom]="activeTab !== 'article'" (click)="onTabChange('article')">
          <i class="bi bi-journal-text me-2 fs-5"></i>
          論壇
        </button>
      </li>
    </ul>
  </div>
  <div class="card-body p-4 d-flex flex-column" style="min-height: 50vh;">
    @if (isFavoriteLoading) {
    <div class="d-flex justify-content-center align-items-center h-100 py-5 text-muted-custom">
      <div class="spinner-border spinner-border-sm text-accent me-2" role="status"></div>
      正在讀取收藏...
    </div>
    }
    @else if (favorites.length === 0) {
    <div class="text-center flex-grow-1 d-flex flex-column justify-content-center">

      <div class="display-1 text-accent mb-3">
        <i class="bi bi-box2-heart"></i>
      </div>

      <p class="text-muted-custom fs-5">
        目前在「{{
        activeTab === 'product' ? '商城' :
        activeTab === 'activity' ? '活動' :
        activeTab === 'course' ? '課程' : '論壇'
        }}」還沒有收藏喔！
      </p>

      <div class="mt-4">
        <a [routerLink]="getGoShopLink()" class="btn btn-outline-custom rounded-pill px-5 py-2 fw-bold transition-btn">
          去逛逛
        </a>
      </div>
    </div>
    }
    @else {
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      @for (item of favorites; track item.favoriteId) {
      <div class="col">
        <div class="card h-100 border-0 shadow-sm hover-shadow transition-card cursor-pointer"
          (click)="goToDetail(item)">
          <div class="card-img-fixed-height">
            <img [src]="getCourseImage(item.imageUrl)" loading="lazy" alt="{{ item.title }}">
            <span
              class="position-absolute top-0 start-0 m-2 badge bg-dark-brown bg-opacity-75 rounded-pill backdrop-blur">
            </span>
            <button class="btn btn-danger btn-sm position-absolute top-0 end-0 m-2 rounded-circle shadow"
              (click)="onRemoveFavorite(item.favoriteId, $event)"><i class="bi bi-trash"></i>
            </button>
          </div>
          <div class="card-body d-flex flex-column">
            <h6 class="card-title fw-bold text-dark-brown text-truncate mb-2">{{ item.title }}</h6>
            @if (item.description) { <p class="card-text small text-muted-custom text-truncate mb-2">{{ item.description
              }}</p> }
            <div class="mt-auto d-flex justify-content-between align-items-center pt-3 border-top mt-2">
              @if (item.targetType === 3) { <span
                class="badge border border-secondary text-secondary bg-transparent fw-normal px-3 py-2"><i
                  class="bi bi-laptop me-1"></i> 線上課程</span> }
              @else if (item.targetType === 1 && item.price !== undefined) { <span class="text-accent fw-bold fs-5">NT$
                {{ item.price }}</span> }
              @else if (item.targetType === 2 && item.date) { <small class="text-muted-custom"><i
                  class="bi bi-calendar-event me-1"></i>{{ item.date }}</small> }
              @else { <span></span> }
              <button class="btn btn-sm btn-outline-custom rounded-pill px-4 py-1 transition-btn">查看詳情</button>
            </div>
          </div>
        </div>
      </div>
      }
    </div>
    }
  </div>
</div>