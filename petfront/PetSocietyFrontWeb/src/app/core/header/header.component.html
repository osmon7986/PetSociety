<!-- Offcanvas: Cart ÂæûÁï´Èù¢ÂÅ¥ÈÇäÊªëÂá∫‰æÜÁöÑÈö±ËóèÂºèÈù¢Êùø -->
<div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasCart" aria-labelledby="My Cart"
  style="--bs-offcanvas-width: 450px;">
  <div class="offcanvas-header justify-content-center">
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <div class="order-md-last">

      <h4 class="d-flex justify-content-between align-items-center mb-3">
        <span class="text-primary">ÊÇ®ÁöÑË≥ºÁâ©Ëªä</span>
        <span class="badge bg-primary rounded-circle pt-2">{{ cartCount }}</span>
      </h4>

      <ul class="list-group mb-3 shadow-sm">

        <ng-container *ngIf="cartItems.length > 0; else emptyCart">
          <li *ngFor="let item of cartItems" class="list-group-item d-flex align-items-center py-3">

            <img [src]="item.thumbnail || 'https://placehold.co/400x400/F2EBE5/5E5344?text=No+Image'"
              alt="{{item.productName}}" class="rounded me-3 border bg-light flex-shrink-0"
              style="width: 60px; height: 60px; object-fit: cover;">

            <div class="d-flex flex-column flex-grow-1 overflow-hidden">

              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="fw-bold text-dark text-truncate mb-0 me-2" [title]="item.productName">
                  {{ item.productName }}
                </h6>

                <button class="btn btn-sm rounded-circle p-0 border-0 btn-trash-soft flex-shrink-0"
                  (click)="removeItem(item.productId)" style="width: 24px; height: 24px;"> <i
                    class="fas fa-trash-alt"></i>
                </button>
              </div>

              <div class="d-flex justify-content-between align-items-end">

                <div class="d-flex align-items-center">
                  <button type="button" class="btn btn-qty rounded-start text-secondary"
                    (click)="updateQuantity(item, -1)" [disabled]="item.quantity <= 1">
                    <i class="fas fa-minus" style="font-size: 0.7rem;"></i>
                  </button>

                  <span class="qty-display fw-bold text-dark">
                    {{ item.quantity }}
                  </span>

                  <button type="button" class="btn btn-qty rounded-end text-secondary"
                    (click)="updateQuantity(item, 1)">
                    <i class="fas fa-plus" style="font-size: 0.7rem;"></i>
                  </button>
                </div>

                <span class="fw-bold text-primary fs-6">
                  NT$ {{ item.price * item.quantity | number }}
                </span>

              </div>

            </div>
          </li>
        </ng-container>

        <ng-template #emptyCart>
          <li class="list-group-item text-center py-4 text-muted">
            Ë≥ºÁâ©ËªäÈÇÑÊòØÁ©∫ÁöÑÂñî üê∂ <br>
            Âø´ÂéªÈÅ∏Ë≥ºÂñúÊ≠°ÁöÑÂïÜÂìÅÂêßÔΩû
          </li>
        </ng-template>

        <li class="list-group-item d-flex justify-content-between align-items-center py-3 bg-light fw-bold">
          <span class="fw-bold">Á∏ΩË®à (TWD)</span>
          <span class="fs-5 text-primary">NT$ {{ totalAmount | number }}</span>
        </li>

      </ul>

      <button class="w-100 btn btn-primary btn-lg" type="button" data-bs-dismiss="offcanvas" routerLink="/mall/cart">
        ÂâçÂæÄÁµêÂ∏≥
      </button>

    </div>
  </div>
</div>
<!-- Offcanvas: Search ÂæûÁï´Èù¢ÂÅ¥ÈÇäÊªëÂá∫‰æÜÁöÑÈö±ËóèÂºèÈù¢Êùø -->
<div class="offcanvas offcanvas-end" data-bs-scroll="true" tabindex="-1" id="offcanvasSearch" aria-labelledby="Search">
  <div class="offcanvas-header justify-content-center">
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">

    <div class="order-md-last">
      <h4 class="text-primary text-uppercase mb-3">
        ÊêúÂ∞ã
      </h4>
      <div class="search-bar border rounded-2 border-dark-subtle">
        <form id="search-form" class="text-center d-flex align-items-center" action="" method="">
          <input type="text" class="form-control border-0 bg-transparent" placeholder="Âú®ÈÄôË£°ÊêúÂ∞ã" />
          <iconify-icon icon="tabler:search" class="fs-4 me-3"></iconify-icon>
        </form>
      </div>
    </div>
  </div>
</div>

<header>
  <div class="sticky-header-content">
    <div class="container py-2">
      <div class="row py-2 pb-0 pb-sm-2 align-items-center ">

        <!-- Logo -->
        <div class="col-sm-4 col-lg-3 text-center text-sm-start">
          <div class="main-logo">
            <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
              <img src="/images/LOGO.png" alt="logo" class="img-fluid" style="width: 40%;">
            </a>
          </div>
        </div>
        <nav class="main-menu d-flex navbar navbar-expand-lg col-sm-8 col-lg-5 justify-content-center">

          <!-- ÊâãÊ©üÁâàÔºöÂè≥‰∏äÂäüËÉΩ iconsÔºàÁôªÂÖ•/ÊÑõÂøÉ/Ë≥ºÁâ©Ëªä/ÊêúÂ∞ãÔºâ -->
          <div class="d-flex d-lg-none align-items-end mt-3 justify-content-end">
            <ul class="d-flex justify-content-end list-unstyled m-0">
              <!-- Â∏≥Êà∂ -->
              <li>
                <a routerLink="/member" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
                  class="mx-3">
                  <iconify-icon icon="healthicons:person" class="fs-4"></iconify-icon>
                </a>
              </li>
              <!-- Wishlist -->
              <li>
                <a (click)="onWishlistClick()" class="mx-3" style="cursor: pointer;">
                  <iconify-icon icon="mdi:heart" class="fs-4"></iconify-icon>
                </a>
              </li>

              <!-- Ë≥ºÁâ©Ëªä Offcanvas -->
              <li>
                <a href="#" class="mx-3" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCart"
                  aria-controls="offcanvasCart">
                  <iconify-icon icon="mdi:cart" class="fs-4 position-relative"></iconify-icon>
                  <span *ngIf="cartCount > 0"
                    class="position-absolute translate-middle badge rounded-circle bg-primary pt-2">
                    {{cartCount}}
                  </span>
                </a>
              </li>

              <!-- ÊêúÂ∞ã Offcanvas
            <li>
              <a href="#" class="mx-3" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSearch"
                aria-controls="offcanvasSearch">
                <iconify-icon icon="tabler:search" class="fs-4"></iconify-icon>

              </a>
            </li> -->
            </ul>

          </div>
          <!-- ÊâãÊ©üÁâàÊº¢Â†°ÈÅ∏ÂñÆÊåâÈàï -->
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar"
            aria-controls="offcanvasNavbar">
            <span class="navbar-toggler-icon"></span>
          </button>
          <!-- OffcanvasÔºöÊâãÊ©üÁâà‰∏ªÈÅ∏ÂñÆ -->
          <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar"
            aria-labelledby="offcanvasNavbarLabel">

            <div class="offcanvas-header justify-content-center">
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>

            <div class="offcanvas-body justify-content-center">
              <!-- ‰∏çÈúÄË¶ÅÁöÑÊ∏ÖÂñÆ -->
              <!-- <select class="filter-categories border-0 mb-0 me-5">
              <option>ÊåâÈ°ûÂà•ÈÅ∏Ë≥º</option>
              <option>Ë°£Êúç</option>
              <option>È£üÁâ©</option>
              <option>È£üÁâ©</option>
              <option>Áé©ÂÖ∑</option>
            </select> -->
              <ul class="navbar-nav menu-list list-unstyled d-flex gap-md-3 mb-0">
                <li class="nav-item">
                  <!-- routerLink È¶ñÈ†Å -->
                  <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }"
                    class="nav-link active">È¶ñÈ†Å</a>
                </li>

                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" role="button" id="course-pages" data-bs-toggle="dropdown"
                    aria-expanded="false">ÂïÜÂüé</a>
                  <ul class="dropdown-menu" aria-labelledby="course-pages">
                    <!-- routerLink ÂïÜÂüé -->
                    <li><a routerLink="/mall" class="dropdown-item">ÊâÄÊúâÂïÜÂìÅ</a></li>
                    <!-- routerLink ÊàëÁöÑË≥ºÁâ©Ëªä -->
                    <li><a routerLink="/mall/cart" class="dropdown-item">ÊàëÁöÑË≥ºÁâ©Ëªä</a></li>
                    <!-- routerLink ÊàëÁöÑË®ÇÂñÆ -->
                    <li><a routerLink="/mall/orders" class="dropdown-item">ÊàëÁöÑË®ÇÂñÆ</a></li>
                  </ul>
                </li>
                <!--  Ê¥ªÂãï‰∏ãÊãâÈÅ∏ÂñÆ -->
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" role="button" id="course-pages" data-bs-toggle="dropdown"
                    aria-expanded="false">Ê¥ªÂãï</a>
                  <ul class="dropdown-menu" aria-labelledby="course-pages">
                    <li><a routerLink="/activity/intro" class="dropdown-item">ÊâÄÊúâÊ¥ªÂãï</a></li>
                    <li><a routerLink="/activity/apply" class="dropdown-item">Ê¥ªÂãïÁî≥Ë´ã</a></li>
                    <li><a routerLink="/activity/calender" class="dropdown-item">ÊàëÁöÑÊ¥ªÂãïÊó•ÊõÜ</a></li>
                  </ul>
                </li>

                <!-- Êú™ÁôªÂÖ•ÁãÄÊÖãÔºåÂÉÖÈ°ØÁ§∫Â≠∏Èô¢(ÊâÄÊúâË™≤Á®ã) -->
                @if (!this.isLogin()) {
                <li class="nav-item">
                  <!-- routerLink Â≠∏Èô¢ -->
                  <a routerLink="/academy" routerLinkActive="active" class="nav-link">Â≠∏Èô¢</a>
                </li>
                }
                @else {
                <!-- Â≠∏Èô¢‰∏ãÊãâÈÅ∏ÂñÆ -->
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" role="button" id="course-pages" data-bs-toggle="dropdown"
                    aria-expanded="false">Â≠∏Èô¢</a>
                  <ul class="dropdown-menu" aria-labelledby="course-pages">
                    <!-- routerLink ÊâÄÊúâË™≤Á®ã -->
                    <li><a routerLink="/academy" class="dropdown-item">ÊâÄÊúâË™≤Á®ã</a></li>
                    <!-- routerLink ÊàëÁöÑË™≤Á®ã -->
                    <li><a routerLink="/academy/my-course" class="dropdown-item">ÊàëÁöÑË™≤Á®ã</a></li>
                  </ul>
                </li>
                }

                <li class="nav-item">
                  <!-- routerLink Ë´ñÂ£á -->
                  <a routerLink="/forum" routerLinkActive="active" class="nav-link">Ë´ñÂ£á</a>
                </li>
                <!-- <li class="nav-item">
                  routerLink Ê∏¨Ë©¶Áî®
                  <a routerLink="/test-token" routerLinkActive="active" class="nav-link">Token</a>
                </li> -->
              </ul>

            </div>

          </div>

        </nav>

        <!-- ÊêúÂ∞ãÊ°ÜÁßªÈô§ -->
        <!-- Search Bar
        <div class="col-sm-6 offset-sm-2 offset-md-0 col-lg-5 d-none d-lg-block">
          <div class="search-bar border rounded-2 px-3 border-dark-subtle">
            <form id="search-form" class="text-center d-flex align-items-center" action="" method="">
              <input type="text" class="form-control border-0 bg-transparent" placeholder="ÊêúÂ∞ãË∂ÖÈÅé 10,000 Á®ÆÂïÜÂìÅ" />
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="currentColor"
                  d="M21.71 20.29L18 16.61A9 9 0 1 0 16.61 18l3.68 3.68a1 1 0 0 0 1.42 0a1 1 0 0 0 0-1.39ZM11 18a7 7 0 1 1 7-7a7 7 0 0 1-7 7Z" />
              </svg>
            </form>
          </div>
        </div> -->

        <!-- ÊúÉÂì° Êî∂Ëóè Ë≥ºÁâ©ËªäÊåâÈàï -->
        <div class="col-lg-4 d-none d-lg-flex justify-content-end align-items-center">
          <ul class="d-flex list-unstyled m-0 p-0">
            <li>
              <a routerLink="/member" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="mx-3"
                title="ÊúÉÂì°‰∏≠ÂøÉ">
                <iconify-icon icon="healthicons:person" class="fs-4"></iconify-icon>
              </a>
            </li>
            <li>
              <a (click)="onWishlistClick()" [class.active]="router.url.includes('/member/wishlist')" class="mx-3"
                style="cursor: pointer;">
                <iconify-icon icon="mdi:heart" class="fs-4"></iconify-icon>
              </a>
            </li>

            <li class="">
              <a href="javascript:void(0)" class="mx-3"
                [attr.data-bs-toggle]="router.url.includes('/mall/cart') ? null : 'offcanvas'"
                data-bs-target="#offcanvasCart" aria-controls="offcanvasCart"
                [style.cursor]="router.url.includes('/mall/cart') ? 'default' : 'pointer'"
                [class.text-muted]="router.url.includes('/mall/cart')"> <iconify-icon icon="mdi:cart"
                  class="fs-4 position-relative"></iconify-icon>

                <span *ngIf="cartCount > 0"
                  class="position-absolute translate-middle badge rounded-circle bg-primary pt-2">
                  {{cartCount}}
                </span>
              </a>
            </li>
          </ul>

        </div>
      </div>
    </div>

    <!-- ÂàÜÈöîÁ∑öÁßªÈô§ -->
    <!-- <div class="container-fluid">
      <hr class="m-0">
    </div> -->

    <!-- Navbar -->
    <!-- <div class="container">

    </div> -->
  </div>
</header>